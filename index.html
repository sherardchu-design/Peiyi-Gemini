<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>珮伊の专属放映厅</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'cinema-bg': '#09090b',      // Zinc 950 (Deep Black)
              'cinema-card': 'rgba(24, 24, 27, 0.8)', // Zinc 900 + Opacity
              'cinema-gold': '#fbbf24',    // Amber 400 (Golden accent)
              'cinema-gold-dim': '#b45309', // Amber 700
              'cinema-red': '#be123c',     // Rose 700 (Velvet Red)
              'cinema-text': '#e4e4e7',    // Zinc 200
              'cinema-silver': '#a1a1aa',  // Zinc 400
            },
            fontFamily: {
              sans: ['"Noto Sans SC"', 'system-ui', 'sans-serif'], 
              mono: ['"Courier New"', 'monospace'], // For script vibes
            },
            animation: {
              'spotlight': 'spotlight 8s ease-in-out infinite alternate',
              'fade-in': 'fadeIn 1s ease-out forwards',
              'flicker': 'flicker 3s infinite',
            },
            keyframes: {
              spotlight: {
                '0%': { backgroundPosition: '0% 50%' },
                '100%': { backgroundPosition: '100% 50%' },
              },
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              flicker: {
                '0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100%': { opacity: '0.99' },
                '20%, 21.999%, 63%, 63.999%, 65%, 69.999%': { opacity: '0.4' },
              }
            }
          },
        },
      }
    </script>
    
    <!-- 2. Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- 3. React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #09090b; }
      ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #fbbf24; }
      
      body {
        margin: 0;
        overflow: hidden;
        background-color: #09090b;
        color: #e4e4e7;
      }
      
      /* Film Grain Effect */
      .film-grain {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        z-index: 5;
        opacity: 0.4;
      }

      .shake-animation {
        animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
      }
      @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
      }
    </style>
<script type="importmap">
{
  "imports": {
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "vite": "https://esm.sh/vite@^7.3.1"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // --- Icons (Cinema Themed) ---
      const IconClapperboard = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="14" x="3" y="7" rx="2" ry="2"/><path d="M7 15h.01"/><path d="M17 15h.01"/><path d="M3 21h18"/><path d="M20.4 7.5 13 3l-1.6 3.4L20 10l.4-2.5Z"/><path d="M8.6 4.6 3 8"/></svg>;
      const IconFilm = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h18"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M17 7.5h4"/><path d="M17 16.5h4"/></svg>;
      const IconTicket = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>;
      const IconPlay = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>;
      const IconLogOut = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>;
      const IconProjector = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 7 3 5"/><path d="M9 6V3"/><path d="M13 7l2-2"/><circle cx="9" cy="13" r="3"/><path d="M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-2.73"/><path d="M3 17h2"/></svg>;

      // --- Constants ---
      const PASSWORD_KEY = 'peiyi2026';
      const SESSION_KEY = 'peiyi_auth_session';

      // --- Components ---

      // 1. Background
      const BackgroundCinema = () => {
        return (
          <div className="absolute inset-0 pointer-events-none overflow-hidden z-0 bg-cinema-bg">
             {/* Spotlights */}
             <div className="absolute -top-[20%] left-[20%] w-[40%] h-[100%] bg-gradient-to-b from-white/10 to-transparent transform -rotate-12 blur-3xl opacity-30"></div>
             <div className="absolute -top-[20%] right-[20%] w-[40%] h-[100%] bg-gradient-to-b from-cinema-gold/10 to-transparent transform rotate-12 blur-3xl opacity-20"></div>
             
             {/* Film Grain */}
             <div className="film-grain"></div>

             {/* Ambient Glow */}
             <div className="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black to-transparent opacity-80"></div>
          </div>
        );
      };

      // 2. Login
      const Login = ({ onLogin }) => {
        const [input, setInput] = useState('');
        const [error, setError] = useState(false);
        const [isUnlocking, setIsUnlocking] = useState(false);

        const handleSubmit = (e) => {
          e.preventDefault();
          setIsUnlocking(true);
          setTimeout(() => {
              const success = onLogin(input);
              if (!success) {
                setError(true);
                setIsUnlocking(false);
                setInput(''); 
              }
          }, 800);
        };

        return (
          <div className="flex flex-col items-center justify-center h-full w-full px-4 font-sans relative z-20">
            <div className={`
              relative w-full max-w-sm 
              bg-cinema-card backdrop-blur-md 
              border border-cinema-gold/30 
              rounded-lg
              shadow-[0_0_50px_-10px_rgba(251,191,36,0.1)] 
              p-8 
              animate-fade-in
              transition-all duration-700 ease-in-out
              ${isUnlocking ? 'scale-105 opacity-0 translate-y-[-20px]' : 'opacity-100'}
            `}>
              {/* Decorative Film Strip Top */}
              <div className="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-cinema-bg border border-cinema-silver/20 px-4 py-2 rounded shadow-lg flex items-center gap-2">
                 <IconFilm className="w-5 h-5 text-cinema-gold" />
                 <span className="text-xs tracking-widest text-cinema-silver uppercase">Admit One</span>
              </div>

              <div className="text-center mb-10 mt-4">
                  <h1 className="text-3xl font-bold text-cinema-text tracking-wide mb-2" style={{textShadow: '0 0 10px rgba(251,191,36,0.3)'}}>
                      珮伊の专属放映厅
                  </h1>
                  <div className="h-[1px] w-24 bg-gradient-to-r from-transparent via-cinema-gold to-transparent mx-auto mb-2"></div>
                  <p className="text-xs text-cinema-silver font-mono uppercase tracking-[0.2em]">
                      Private Cinema · Gemini
                  </p>
              </div>

              <form onSubmit={handleSubmit} className="space-y-6">
                  <div className="relative group">
                      <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10">
                          <IconTicket className={`w-5 h-5 transition-colors duration-300 ${error ? 'text-cinema-red' : 'text-cinema-gold group-focus-within:text-white'}`} />
                      </div>
                      <input type="password" value={input} onChange={(e) => { setInput(e.target.value); setError(false); }}
                          className={`
                              w-full bg-black/50 border rounded px-4 py-3.5 pl-12
                              text-cinema-text placeholder-gray-600
                              outline-none transition-all duration-300 font-mono text-sm
                              ${error 
                                ? 'border-cinema-red shadow-[0_0_15px_-3px_rgba(220,38,38,0.5)] shake-animation' 
                                : 'border-gray-800 focus:border-cinema-gold focus:shadow-[0_0_15px_-3px_rgba(251,191,36,0.3)]'}
                          `}
                          placeholder="请输入入场券号码..." autoFocus />
                  </div>
                  
                  {error && <div className="text-center text-xs text-cinema-red font-mono font-bold animate-flicker">[ERROR] 票号无效 / INVALID TICKET</div>}
                  
                  <button type="submit" disabled={!input} className={`
                      w-full mt-2 
                      bg-gradient-to-r from-cinema-gold-dim to-cinema-gold
                      text-black font-bold py-3.5 px-4 
                      rounded
                      shadow-lg transform transition-all duration-300 
                      flex items-center justify-center gap-2
                      hover:brightness-110
                      ${!input ? 'opacity-50 cursor-not-allowed grayscale' : 'hover:-translate-y-0.5 cursor-pointer'}
                  `}>
                      <span className="tracking-widest">检票入场</span>
                      <IconPlay className="w-4 h-4 fill-black" />
                  </button>
              </form>
              
              <div className="mt-8 text-center opacity-40">
                  <p className="text-[10px] text-cinema-silver font-mono">EST. 2026 · PEIYI PRODUCTION</p>
              </div>
            </div>
          </div>
        );
      };

      // 3. Chat Interface
      const ChatInterface = ({ onLogout }) => {
        return (
          <div className="flex flex-col h-full w-full bg-transparent relative z-20">
            {/* Header */}
            <header className="flex-none h-16 bg-black/80 backdrop-blur border-b border-white/10 flex items-center justify-between px-6 z-30 shadow-2xl">
              <div className="flex items-center gap-4">
                  <div className="bg-cinema-gold/10 p-2 rounded border border-cinema-gold/20">
                      <IconClapperboard className="w-5 h-5 text-cinema-gold" />
                  </div>
                  <div className="flex flex-col">
                      <h1 className="text-lg font-bold text-cinema-text tracking-wide">珮伊の专属放映厅</h1>
                      <span className="text-[10px] text-cinema-gold/80 font-mono tracking-wider uppercase">Now Playing: Gemini</span>
                  </div>
              </div>
              <button onClick={onLogout} className="group flex items-center gap-2 px-4 py-1.5 rounded bg-white/5 border border-white/10 hover:bg-white/10 hover:border-cinema-red/50 transition-all duration-300">
                  <span className="text-xs font-medium text-gray-400 group-hover:text-cinema-red transition-colors hidden sm:inline">离场 / EXIT</span>
                  <IconLogOut className="w-4 h-4 text-gray-500 group-hover:text-cinema-red transition-colors" />
              </button>
            </header>
            
            {/* Main Screen Area */}
            <main className="flex-1 relative overflow-hidden w-full flex flex-col p-4 sm:p-6">
              {/* Screen Frame */}
              <div className="flex-1 w-full h-full relative bg-black/40 backdrop-blur-sm rounded-lg border border-white/10 shadow-2xl overflow-hidden ring-1 ring-white/5">
                  <div className="absolute top-[-20px] left-[20px] text-white opacity-[0.03] z-0 pointer-events-none rotate-12">
                      <IconProjector className="w-48 h-48" />
                  </div>
                  {/* The Chatbot */}
                  <iframe src="https://udify.app/chatbot/3GHTKiJAdShhHyUl" style={{ width: '100%', height: '100%' }} frameBorder="0" allow="microphone" title="Dify Chatbot" className="absolute inset-0 w-full h-full z-10" />
                  
                  {/* Screen Glare Effect */}
                  <div className="absolute top-0 right-0 w-full h-1/3 bg-gradient-to-b from-white/5 to-transparent pointer-events-none z-20"></div>
              </div>
            </main>
          </div>
        );
      };

      // 4. Main App
      const App = () => {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [isLoading, setIsLoading] = useState(true);

        useEffect(() => {
          const storedAuth = sessionStorage.getItem(SESSION_KEY);
          if (storedAuth === 'true') setIsAuthenticated(true);
          setTimeout(() => setIsLoading(false), 1200); // Slightly longer intro for dramatic effect
        }, []);

        const handleLogin = (password) => {
          if (password === PASSWORD_KEY) {
            sessionStorage.setItem(SESSION_KEY, 'true');
            setIsAuthenticated(true);
            return true;
          }
          return false;
        };

        const handleLogout = () => {
          sessionStorage.removeItem(SESSION_KEY);
          setIsAuthenticated(false);
        };

        if (isLoading) {
          return (
            <div className="h-screen w-screen bg-cinema-bg flex flex-col items-center justify-center text-cinema-text">
              <IconProjector className="w-16 h-16 text-cinema-gold animate-pulse mb-6" />
              <div className="font-mono text-xl tracking-[0.5em] animate-flicker">LOADING FILM...</div>
            </div>
          );
        }

        return (
          <div className="relative h-screen w-screen overflow-hidden flex flex-col font-sans text-cinema-text selection:bg-cinema-gold selection:text-black">
            <BackgroundCinema />
            <div className="relative z-10 w-full h-full flex flex-col">
              {!isAuthenticated ? <Login onLogin={handleLogin} /> : <ChatInterface onLogout={handleLogout} />}
            </div>
          </div>
        );
      };

      // 5. Error Boundary
      class ErrorBoundary extends React.Component {
        constructor(props) {
          super(props);
          this.state = { hasError: false, error: null };
        }
        static getDerivedStateFromError(error) { return { hasError: true, error }; }
        render() {
          if (this.state.hasError) {
            return (
              <div style={{height:'100vh',width:'100vw',backgroundColor:'#09090b',color:'#e4e4e7',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontFamily:'monospace'}}>
                <h1 style={{fontSize:'3rem',marginBottom:'1rem',color:'#dc2626'}}>TECHNICAL DIFFICULTIES</h1>
                <div style={{border:'1px solid #dc2626', padding:'2rem', color:'#dc2626'}}>
                   PLEASE STAND BY...
                </div>
                <button onClick={() => window.location.reload()} style={{marginTop:'2rem',padding:'0.5rem 2rem',background:'transparent',border:'1px solid white',color:'white',cursor:'pointer'}}>RELOAD REEL</button>
              </div>
            );
          }
          return this.props.children;
        }
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<React.StrictMode><ErrorBoundary><App /></ErrorBoundary></React.StrictMode>);
    </script>
</body>
</html>